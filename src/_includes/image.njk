{% macro image(src, alt, settings, appUrl) %}

{%- set sizes = settings.sizes -%}

{# The base url for Cloudinary to fetch the images #}
{%- set base = "https://alienlebarge.imgix.net" -%}

{# path #}
{%- set path -%}{{ src | url }}{%- endset %}

{# set transformations with the default width #}
{%- set transformations -%}
    {%- if settings.ratio -%}
    ar={{ settings.ratio }}+
    {%- endif -%}
    {%- if settings.width -%}
    w={{ settings.width }}+
    {%- endif -%}
    fit=crop
{%- endset -%}
{% set transformations %}{{ transformations | replace("+", "&") | safe }}{% endset %}



{# set srcset without the default width#}
{%- set srcset -%}
    {%- for width in settings.widths -%}
        {{ base }}{{ path }}?w={{ width }}&{%- if settings.ratio -%}ar={{ settings.ratio }}&{%- endif -%}fit=crop {{ width }}w
        {%- if not loop.last -%},{%- endif -%}
    {%- endfor -%}
{%- endset -%}



{# Put everything together to build the img src #}
{%- set src -%}{{ base }}{{ path }}?{{ transformations | safe }}{%- endset -%}



{# Output #}
<img src="{{ src }}" class="u-photo" srcset="{{ srcset }}" sizes="{{ settings.sizes }}" alt="{{ alt }}" loading="lazy">

{% endmacro %}
